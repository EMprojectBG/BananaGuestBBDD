package com.netmind.db;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.util.logging.Logger;

import com.netmind.models.UsuarioBB;

public final class UsuarioBBBDAOImpl extends UsuarioBBDAO {
	private static Logger logger = Logger.getLogger("UsuarioBBBDAOImpl");
	
	private static UsuarioBBBDAOImpl instance = null;

	public static UsuarioBBBDAOImpl getInstance() {
		if (instance == null) {
			instance = new UsuarioBBBDAOImpl();
		}
		return instance;
	}
	
	@Override
	public UsuarioBB getUsuarioBB(String email, String password) {
		UsuarioBB UsuarioBBADevolver = null;

		try {
			Connection conn = datasource.getConnection();
			// ordenes sql
			String sql = "SELECT u.* FROM UsuarioBB u WHERE u.email=? AND password=? LIMIT 1";
			PreparedStatement pstm = conn.prepareStatement(sql);
			pstm.setString(1, email);
			pstm.setString(2, pass);

			ResultSet rs = pstm.executeQuery();

			if (rs.next()) {

				UsuarioBBADevolver = new UsuarioBB(rs.getInt("uid"), rs.getString("nombre"), rs.getString("apellido"),
						rs.getString("email"), rs.getString("coquetitud"), rs.getDouble("saldo"), "",
						rs.getDate("nacimiento"), rs.getInt("activo"));
			}

			pstm.close();
			conn.close();

			logger.info("Conexión exitosa");

		} catch (Exception e) {
			logger.severe("Error en la conexión de BBDD:" + e);
			UsuarioBBADevolver = null;
		}

		return UsuarioBBADevolver;
	}

	@Override
	public boolean delUsuarioBB(int uid) {
		// TODO Auto-generated method stub
		return false;
	}

	@Override
	public boolean insertUsuarioBB(UsuarioBB user) {
		// TODO Auto-generated method stub
		return false;
	}

	@Override
	public boolean updateUsuarioBB(UsuarioBB user) {
		// TODO Auto-generated method stub
		return false;
	}

	@Override
	public UsuarioBB getUsuarioBB(int uid) {
		UsuarioBB UsuarioBBADevolver = null;

		try {
			Connection conn = datasource.getConnection();
			// ordenes sql
			String sql = "SELECT u.* FROM UsuarioBB u WHERE u.uid=?LIMIT 1";
			PreparedStatement pstm = conn.prepareStatement(sql);
			pstm.setInt(1, uid);

			ResultSet rs = pstm.executeQuery();

			if (rs.next()) {

				UsuarioBBADevolver = new UsuarioBB(rs.getInt("uid"), rs.getString("nombre"), rs.getString("apellido"),
						rs.getString("email"), rs.getString("coquetitud"), rs.getDouble("saldo"), "",
						rs.getDate("nacimiento"), rs.getInt("activo"));
			}

			pstm.close();
			conn.close();

			logger.info("Conexión exitosa");

		} catch (Exception e) {
			logger.severe("Error en la conexión de BBDD:" + e);
			UsuarioBBADevolver = null;
		}

		return UsuarioBBADevolver;
	}

}
